{% extends 'base.html' %}
{% block content %}

<div class="loader"></div>

<div style="margin-top:50px;float:right;">

    <select id="durationSelected" name="durationSelected">
        <option value="bitfinex">BITFINEX</option>
        <!--<option value="weekly">Weekly</option>-->
        <!--<option value="monthly">Monthly</option>-->
    </select>

    <select id="coinSelected" name="coinSelected">
        {% for symbol in symbols %}
        <option value="{{symbol}}">{{symbol.upper}}</option>
        {% endfor%}
    </select>
</div>
<div style="width: 100%;overflow:auto;">
    <div style="float:right; width: 70%">
        <div id="chart_panel" class="panel-body"
             style="width:100%;height:500px"></div>
    </div>
    <div style="float:left;padding:20px;">
        <b>Price:</b>&nbsp;&nbsp; <span style="color:blue" id="price"> $1000</span> &nbsp;&nbsp; &nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;
        <span style="float:right;"><b>High:</b>&nbsp;&nbsp; <span style="color:blue" id="high"> $1170</span></span>

        <p><b>Low:</b>&nbsp;&nbsp; <span style="color:blue" id="low"> $870</span>
           </p>
        <b>Ask:</b>&nbsp;&nbsp; <span style="color:blue" id="ask"> $1000</span> &nbsp;&nbsp; &nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;

        <span style="float:right;"><b>Bid:</b>&nbsp;&nbsp; <span style="color:blue;" id="bid"> $1170</span></span>
        <p><b>Volume:</b>&nbsp;&nbsp; <span style="color:blue" id="vol"> 13082301 BTC</span></p>
    </div>
</div>

<!--<div class="panel panel-default">-->
<!--<div id="chart_panel" class="panel-body"-->
<!--style="width:100%;height:500px"></div>-->
<!--</div>-->

<script type="text/javascript">
$(document).ready(function() {
   function showGraph(duration,coinId, coinName){
    var user_graph = {
    chart: {
    renderTo: 'chart_panel',
     <!--events: {-->
            <!--load: function () {-->

                <!--// set up the updating of the chart each second-->
                <!--var series = this.series[0];-->
                <!--setInterval(function () {-->
                    <!--Url = "/update_data/"+coinId;-->
                    <!--$.getJSON(Url,-->
                        <!--function(data) {-->
                            <!--var x = data['timestamp']; // current time-->
                            <!--var y = data['last_price'];-->
                            <!--document.getElementById("price").innerHTML = data['price']+ " " + data['sub_currency'];-->
                            <!--document.getElementById("high").innerHTML = data['high']+ " " + data['sub_currency'];-->
                            <!--document.getElementById("low").innerHTML = data['low']+ " " + data['sub_currency'];-->
                            <!--document.getElementById("vol").innerHTML = data['volume']+ " " + data['main_currency'];-->
                            <!--document.getElementById("ask").innerHTML = data['ask']+ " " + data['sub_currency'];-->
                            <!--document.getElementById("bid").innerHTML = data['bid']+ " " + data['sub_currency'];-->
                            <!--series.addPoint([x, y], true, true);-->
                        <!--});-->
                    <!--}, 5000);-->
                <!--}-->
            <!--},-->
    type: 'line',
    },
    legend: {enabled: false},
    title: {text: 'Price  Graph'},
    subtitle: {text: 'Price Vs Date'},
    xAxis: {title: {text: null}, labels: {rotation: -45}},
    yAxis: {title: {text: null}},
    series: [{}],
    };
    chartDataUrl = "/"+duration+"/"+coinId;
    $.getJSON(chartDataUrl,
    function(data) {
    user_graph.xAxis.categories = data['dates'];
    user_graph.series[0].name = 'price in $';
    user_graph.series[0].data = data['prices'];
    user_graph.title['text'] = 'Price Graph of '+ coinName;
    document.getElementById("price").innerHTML = data['price']+ " " + data['sub_currency'];
    document.getElementById("high").innerHTML = data['high']+ " " + data['sub_currency'];
    document.getElementById("low").innerHTML = data['low']+ " " + data['sub_currency'];
    document.getElementById("vol").innerHTML = data['volume']+ " " + data['main_currency'];
    document.getElementById("ask").innerHTML = data['ask']+ " " + data['sub_currency'];
    document.getElementById("bid").innerHTML = data['bid']+ " " + data['sub_currency'];

    var chart = new Highcharts.Chart(user_graph);
     $(".loader").fadeOut("slow");
    });
    };

    var coinId = $('#coinSelected').val();
    var duration = $('#durationSelected').val();
    var coinName = $("#coinSelected :selected").text();
    showGraph(duration,coinId,coinName);
    updateData();

 $("#coinSelected").change(function() {
    $(".loader").show();
    var coinId = $('#coinSelected').val();
    var coinName = $("#coinSelected :selected").text();
    showGraph(duration,coinId,coinName);
  });

 $("#durationSelected").change(function() {
    $(".loader").show();
    var coinId = $('#coinSelected').val();
    var coinName = $("#coinSelected :selected").text();
    var duration = $('#durationSelected').val();
    showGraph(duration,coinId,coinName);
  });

function updateData() {
    setInterval(function(){
        Url = "/update_data/"+$('#coinSelected').val();
        $.getJSON(Url,
            function(data) {
                <!--var x = data['timestamp']; // current time-->
                <!--var y = data['last_price'];-->
                document.getElementById("price").innerHTML = data['price']+ " " + data['sub_currency'];
                document.getElementById("high").innerHTML = data['high']+ " " + data['sub_currency'];
                document.getElementById("low").innerHTML = data['low']+ " " + data['sub_currency'];
                document.getElementById("vol").innerHTML = data['volume']+ " " + data['main_currency'];
                document.getElementById("ask").innerHTML = data['ask']+ " " + data['sub_currency'];
                document.getElementById("bid").innerHTML = data['bid']+ " " + data['sub_currency'];
                <!--series.addPoint([x, y], true, true);-->
            });
            },
             5000);
}

});

</script>
{% endblock %}